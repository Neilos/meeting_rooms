
<% unless @membership.user %>
  <div class="col-lg-offset-2 col-lg-10">
    <div class="input-group">
      <%= search_field(:user, :email, :class => "form-control", :id => 'email_search_box') %>
      <span class="input-group-btn">
        <button class="btn btn-default" type="button" onclick="searchForUserByEmail()">Search</button>
      </span>
    </div>
  </div>
<% end %>

<% unless @membership.organization %>
  <div class="col-lg-offset-2 col-lg-10">
    <div class="input-group">
      <%= search_field(:organization, :name, :class => "form-control", :id => "org_search_box") %>
      <span class="input-group-btn">
        <button  class="btn btn-default" type="button" onclick="searchForOrganizationByName()">Search</button>
      </span>
    </div>
  </div>
<% end %>
<div id="search_results"></div>

<form class="form-horizontal" role="form">
  <div class="form-group">
    <label class="control-label col-lg-2">organization:</label>
    <div class="col-lg-10">
      <p class="form-control-static"><%= @membership.organization.name if @membership.organization %> </p>
    </div>
  </div>
</form>

<form class="form-horizontal" role="form">
  <div class="form-group">
    <label class="control-label col-lg-2">member:</label>
    <div class="col-lg-10">
      <p class="form-control-static"><%= @membership.user.name if @membership.user %> </p>
    </div>
  </div>
</form>

<%= form_for [@membership.organization || @membership.user, @membership], :html => { :class => 'form-horizontal' } do |f| %>
  <% if @membership.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@membership.errors.count, "error") %> prohibited this membership from being saved:</h2>

      <ul>
      <% @membership.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% if @permission_set.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@permission_set.errors.count, "error") %> prohibited this permission_set from being saved:</h2>

      <ul>
      <% @permission_set.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  
  <div class="form-group">
    <%= f.label :user_id, :class => 'control-label col-lg-2' %>
    <div class="col-lg-10">
      <%= f.text_field :user_id, :class => 'text_field', :value => (@membership.user.id if @membership.user) %>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :organization_id, :class => 'control-label col-lg-2' %>
    <div class="col-lg-10">
      <%= f.text_field :organization_id, :class => 'text_field', :value => (@membership.organization.id if @membership.organization) %>
    </div>
  </div>

<%= render 'permission_sets/form_fields' %>

<<<<<<< HEAD
  <div class="form-actions">
    <%= f.submit nil, :class => 'btn btn-primary' %>
    <% if params[:user_id] %>
      <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                user_path(@membership.user), :class => 'btn' %>
    <% elsif params[:organization_id] %>
        <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                organization_path(@membership.organization), :class => 'btn' %>
    <% end %>
=======
  <div class="form-group">
    <div class="col-lg-offset-2 col-lg-10">
      <%= f.submit nil, :class => 'btn btn-primary' %>
      <% if params[:user_id] %>
        <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                  user_path(@membership.user), :class => 'btn btn-default' %>
      <% elsif params[:organization_id] %>
          <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                  organization_path(@membership.organization), :class => 'btn btn-default' %>
      <% end %>
    </div>
>>>>>>> 2cfaf76... bug fix: changes to membership permissions now persist.
  </div>
<% end %>
